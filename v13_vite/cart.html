<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart | Christin Morton</title>
    <link rel="stylesheet" type="text/css" href="/css/icofont.min.css" />
    <!-- Direct SCSS load to prevent FOUC in Vite -->
    <link rel="stylesheet" href="/src/scss/main.scss" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet" />
    <style>
        .cart-header {
            padding: 140px 0 40px;
            background: #111;
            text-align: center;
        }

        .cart-container {
            max-width: 800px;
            margin: 0 auto;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 40px;
            margin-bottom: 80px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 0;
            border-bottom: 1px solid #333;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 20px;
            background: #222;
        }

        .item-details {
            flex: 1;
        }

        .item-title {
            color: white;
            font-size: 1.1rem;
            margin: 0 0 5px 0;
        }

        .item-price {
            color: #999;
        }

        .item-actions button {
            background: transparent;
            border: none;
            color: #ff4444;
            cursor: pointer;
            text-decoration: underline;
        }

        .cart-summary {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #333;
            text-align: right;
        }

        .cart-total {
            font-size: 1.5rem;
            color: white;
            margin-bottom: 20px;
        }

        .checkout-actions {
            display: flex;
            justify-content: flex-end;
            gap: 20px;
        }

        .btn-checkout {
            background: var(--primary-color);
            color: black;
            padding: 15px 30px;
            border: none;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .btn-clear {
            padding: 15px 20px;
            background: transparent;
            border: 1px solid #444;
            color: #ccc;
            cursor: pointer;
        }

        .empty-cart-msg {
            text-align: center;
            padding: 40px;
            color: #999;
        }
    </style>
</head>

<body>

    <header id="header-nav" class="header-nav">
        <div class="site-container">
            <div class="header-left">
                <a class="logo" href="index.html">
                    <img src="/logo_2.png" alt="Christin Morton Logo">
                </a>
            </div>
            <div class="header-right desktop-only">
                <nav class="main-nav">
                    <ul class="nav-menu">
                        <li><a href="work.html" class="nav-link">Work</a></li>
                        <li><a href="service.html" class="nav-link">Services</a></li>
                        <li><a href="store.html" class="nav-link">Store</a></li>
                        <li>
                            <a href="cart.html" class="nav-link active">Cart</a>
                        </li>
                        <li><a href="login.html" class="action-button small">Portal</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <section class="cart-header">
            <div class="site-container">
                <h1 class="hero-title">Your Cart</h1>
            </div>
        </section>

        <section class="site-container">
            <div class="cart-container" id="cart-wrapper">
                <!-- Cart items injected here -->
                <p>Loading cart...</p>
            </div>
        </section>
    </main>

    <script type="module">
        import { cart } from '/src/js/cart.js';
        import { store } from '/src/js/store.js';

        // NOTE: In a real implementation, the server "Add to Cart" URL might handle ID and QTY parameters.
        // For standard WC, it's typically /checkout/?add-to-cart=ID
        const WC_CHECKOUT_URL = 'http://general-wp.local/checkout/';

        document.addEventListener('DOMContentLoaded', () => {
            renderCart();

            // Listen for updates from other tabs/actions
            window.addEventListener('cartUpdated', renderCart);
        });

        function renderCart() {
            const items = cart.getCart();
            const wrapper = document.getElementById('cart-wrapper');

            if (items.length === 0) {
                wrapper.innerHTML = `
                    <div class="empty-cart-msg">
                        <h2>Your cart is empty</h2>
                        <a href="store.html" style="color: var(--primary-color);">Browse Store</a>
                    </div>
                `;
                return;
            }

            const total = cart.getTotal();
            const formattedTotal = store.formatPrice(total);

            // Construct checkout URL string with current items
            // Standard WC: ?add-to-cart=ID&quantity=QTY
            // Adding multiple items via URL is tricky without a plugin or custom endpoint.
            // MVP Strategy: Redirect to checkout with the FIRST item, or alerting user.
            // Ideally, the cart logic should have been syncing with the server session all along.
            // Since we promised a simple redirect:
            // Let's just create a link to start the checkout process. 
            // Better MVP: Just link to the checkout page assuming the user will handle it there 
            // OR use ?add-to-cart=ID for one items.
            // For now, let's link to the generic checkout page.

            const listHtml = items.map(item => `
                <div class="cart-item">
                    <img src="${item.image || ''}" class="item-image" alt="${item.name}">
                    <div class="item-details">
                        <h3 class="item-title">${item.name}</h3>
                        <div class="item-price">${store.formatPrice(item.price)} x ${item.quantity}</div>
                    </div>
                    <div class="item-actions">
                        <button data-id="${item.id}" class="btn-remove">Remove</button>
                    </div>
                </div>
            `).join('');

            wrapper.innerHTML = `
                <div class="cart-list">${listHtml}</div>
                <div class="cart-summary">
                    <div class="cart-total">Total: ${formattedTotal}</div>
                    <div class="checkout-actions">
                        <button id="btn-clear" class="btn-clear">Clear Cart</button>
                        <a href="${WC_CHECKOUT_URL}" class="btn-checkout">Proceed to Checkout</a>
                    </div>
                    <p style="font-size: 0.8rem; color: #666; margin-top: 10px;">
                        * You will be redirected to our secure payment server to complete your order.
                    </p>
                </div>
            `;

            // Bind events
            wrapper.querySelectorAll('.btn-remove').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    cart.removeItem(e.target.dataset.id);
                    renderCart();
                });
            });

            document.getElementById('btn-clear').addEventListener('click', () => {
                cart.clearCart();
                renderCart();
            });
        }
    </script>
    <script type="module" src="/src/main.js"></script>
</body>

</html>